

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Flows</title>
    <link rel="stylesheet" type="text/css" href="../../css/main.css">
    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha256-/SIrNqv8h6QGKDuNoLGA4iret+kyesCkHGzVUUV0shc=" crossorigin="anonymous"></script>
  </head>
  <body>
    <section class="docs">
      <aside>

        <div class="logoContainer">
          <a href="/">
            <img src="../../images/logo.svg" class="logo" />
            Piscosour
          </a>

        </div>
        <ul class="main_menu">
          
            
            <li>
              <h4>General</h4>
              
                
                  
                    <a href="../../developers/what_is_piscosour.html">What is piscosour</a>
                  
                
              
                
                  
                    <a href="../../developers/get_started.html">Get started</a>
                  
                
              
                
              
                
              
                
              
            </li>

            <li>
              <h4>Guides</h4>
              <ul>
              
                
              
                
              
                
              
                
                  
                  <li>
                    
                    <a href="../../developers/guides/01-contexts.html">Contexts</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/02-steps.html">Steps</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/03-flows.html" class="selected">Flows</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/04-stages.html">Stages</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/05-parameters.html">Parameters</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/06-inquire.html">Inquire</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/07-plugins.html">Plugins</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/08-parameters_between_steps.html">Communication between steps</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/09-steps-advanced.html">Advanced features in steps</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/10-requirements.html">Requirements</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/11-configuration.html">Recipe Configuration</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/12-guidelines.html">Guidelines</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/13-analytics.html">Google Analytics Integration</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/14-logger.html">Logger</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/15-implementations.html">Implementations</a>
                    
                  </li>
                  
                
              
                
              
              </ul>
            </li>

            <li>
              <h4>Tutorials</h4>
              <ul>
              
                
              
                
              
                
              
                
              
                
                  
                  <li>
                    
                    <a href="../../developers/tutorials/pisco-website.html">Create WebSite Recipe</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/tutorials/img-empty-submenu.png"></a>
                    
                  </li>
                  
                
              
              </ul>
            </li>

            
            <li>
              <h4>Plugins</h4>
              <ul>
                
                  
                
                  
                
                  
                    
                    <li>
                      
                      <a href="../../developers/documents/context.html">context</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/fsutils.html">fsutils</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/inquirer.html">inquirer</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/installer.html">installer</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/launcher.html">launcher</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/os.html">os</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/piscosour.html">piscosour</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/skipper.html">skipper</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/stream-write-hook.html">stream-write-hook</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/system-checker.html">system-checker</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/system-saver.html">system-saver</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/test.html">test</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/userConfig.html">userConfig</a>
                      
                    </li>
                    
                  
                
                  
                
                  
                
              </ul>
            </li>
            
            
          
            
          
            
          
            
          
        </ul>

        
          
        
          
        
          
        
          
          <a href="../../users/get_started.html"
            class="switch_target">
            Docs for users
          </a>
          
        
      </aside>
      <article>
        <h1 id="flows">Flows</h1>
<p>Flows are a list of executed steps. A command are a flow for piscosour. The flows don&#39;t work over a <a href="./01-contexts-md">context</a>, <a href="./02-steps.html">step</a> do that, so flows can work over multiple steps, and different contexts. </p>
<p>The flow execution is sequential, step by step, and step are executed for each context. Note that if a step is no defined for any context it is no executed.</p>
<p>Flows are implements with three files in the recipe:</p>
<pre><code>-rwxr-xr-x    1 pisco  staff   flows/flow-name/config.json
-rwxr-xr-x    1 pisco  staff   flows/flow-name/info.md
</code></pre><p>Where the <code>config.json</code> file has the configuration, <code>info.md</code> explain and document the flow.</p>
<p>Note, it exists a <a href="#scaffold">scaffold generator tool</a></p>
<h2 id="-config-json-configuration"><code>config.json</code> configuration</h2>
<p>The <code>config.json</code> file has the definition of the flow. A example is:</p>
<pre><code class="lang-json">{
  &quot;name&quot;: &quot;Create from scratch&quot;,
  &quot;description&quot;: &quot;Starting a repository from scratch&quot;,
  &quot;type&quot; : &quot;normal&quot;,
  &quot;excludes&quot; : [ &quot;any&quot; ],
  &quot;isGenerator&quot;: true,
  &quot;params&quot;: {
    &quot;param1&quot;: &quot;value1&quot;,
    &quot;param2&quot;: 2,
    &quot;param3&quot;: true,
    &quot;param4&quot;: { &quot;object1&quot;: &quot;value&quot; }
  },
  &quot;steps&quot;: {
    &quot;step1&quot;: {
        &quot;excludes&quot; : [ &quot;any&quot; ],
        &quot;params&quot;: {
            &quot;param1&quot;: &quot;value1&quot;,
            &quot;param2&quot;: 2
        }
    },
    &quot;step2&quot;: {
        &quot;watchContext&quot; : true,
        &quot;type&quot; : &quot;flow&quot;,
    },
    &quot;step3&quot;: {
        &quot;implementation-check&quot; : false    
    }
  }
}
</code></pre>
<p>In the <code>config.json</code> file could be configured the following fields:</p>
<h3 id="-name-property"><code>name</code> property</h3>
<p>Short name of the flow, it must be descriptive and unique.</p>
<ul>
<li>It is mandatory</li>
<li>String type expected</li>
</ul>
<h3 id="-description-property"><code>description</code> property</h3>
<p>It is a short description about the flow.</p>
<ul>
<li>It is mandatory</li>
<li>String type expected</li>
</ul>
<h3 id="-type-property"><code>type</code> property</h3>
<p>Type of the flows</p>
<ul>
<li>It is optional.</li>
<li>String type expected.</li>
<li>Two value options:<ol>
<li><code>normal</code>: appears in the command list. It is the default value.</li>
<li><code>internal</code>: doesn&#39;t appear int command list. It is for an internal purpose.</li>
</ol>
</li>
</ul>
<h3 id="-excludes-property"><code>excludes</code> property</h3>
<p>Is an array of contexts witch execution is excluded for all steps of this flow. For example:</p>
<pre><code class="lang-json">{
  &quot;name&quot;: &quot;validate&quot;,
  &quot;description&quot;: &quot;Validate CI flow&quot;,
  &quot;excludes&quot;: [&quot;develop&quot;, &quot;master&quot;, &quot;feature&quot;, &quot;hotfix&quot;, &quot;release&quot;, &quot;merger&quot;, &quot;consolidation&quot;],
    &quot;steps&quot;: {
      &quot;install&quot;: {
        &quot;type&quot;: &quot;flow&quot;
      },
  ....
}
</code></pre>
<p>The execution of this flow will prompt this message on output:</p>
<pre><code class="lang-shell">[18:13:32] Run of flow &quot;install&quot; is excluded for context &quot;feature&quot;
</code></pre>
<h3 id="-isgenerator-property"><code>isGenerator</code> property</h3>
<p>If the steps creates a context, then this flag must be with a &#39;true&#39; value.</p>
<ul>
<li>It is optional</li>
<li>The default value is &#39;false&#39;.</li>
<li>Boolean type expected</li>
</ul>
<h3 id="-params-property"><code>params</code> property</h3>
<p>Others customized paramaters, see <a href="./05-parameters.html">parameters</a> for more information.</p>
<ul>
<li>It is optional</li>
<li>The default value is an empty array. <code>&quot;params&quot;: []&quot;</code></li>
<li>Array of objects expected</li>
</ul>
<p>Example:</p>
<pre><code class="lang-json">{
  &quot;params&quot;: {
    &quot;param1&quot;: &quot;value1&quot;,
    &quot;param2&quot;: 2,
    &quot;param3&quot;: true,
    &quot;param4&quot;: { &quot;object1&quot;: &quot;value&quot; }
  }
}
</code></pre>
<h3 id="-a-name-parameters-a-understanding-parameters-in-flows"><a name="parameters"></a>Understanding parameters in flows</h3>
<p>The &#39;config.json&#39; file of a flow has the following possibilities:</p>
<p><strong>a. Common parameters for all steps</strong></p>
<pre><code class="lang-json">{
  &quot;params&quot;: {
    &quot;param1&quot;: &quot;value1&quot;,
    &quot;param2&quot;: &quot;value2&quot;,
    &quot;param3&quot;: &quot;value3&quot;
  }
}
</code></pre>
<p><strong>b. Common parameters for all contexts in a specific step</strong></p>
<pre><code class="lang-json">{
  &quot;params&quot;: {},
  &quot;steps&quot; : {
    &quot;stepName&quot; : {
      &quot;params&quot; : {
        &quot;param1&quot;: &quot;value1&quot;,
        &quot;param2&quot;: &quot;value2&quot;,
        &quot;param3&quot;: &quot;value3&quot;,
      }
    }
  }
}
</code></pre>
<p><strong>c. Parameters for a specific step and context</strong></p>
<pre><code class="lang-json">{
  &quot;params&quot;: {},
  &quot;steps&quot; : {
    &quot;stepName&quot; : {
      &quot;contextName&quot; : {
        &quot;params&quot; : {
          &quot;param1&quot;: &quot;value1&quot;,
          &quot;param2&quot;: &quot;value2&quot;,
          &quot;param3&quot;: &quot;value3&quot;
        }
      }
    }
  }
}
</code></pre>
<p>Allways the parameters are available with <code>this.params</code>.</p>
<p>Example:</p>
<pre><code class="lang-javascript">module.export = {
  run: function() {
    console.log(
      this.params.param1,
      this.params.param2,
      this.params.param3);
  }
}
</code></pre>
<p>The priority is (from high to low):</p>
<ol>
<li>Parameters for a specific step and context</li>
<li>Common parameters for all contexts in a specific step</li>
<li>Common parameters for all steps.</li>
</ol>
<h3 id="-step-property"><code>step</code> property</h3>
<p>List of sequential steps in the flow.</p>
<ul>
<li>It is mandatory</li>
<li>Object with the list of step-key:config. Where <code>config</code> is an object that optionally contains:<ul>
<li><code>type</code> which can be <code>flow</code> or <code>step</code> (step is default value). Flow calls another flow with the name of the step. Nesting could be whatever.</li>
<li><code>params</code> with the list of parameters of the step. See <a href="./05-parameters.html">parameters</a> for more information. <em>Please note that it isn&#39;t appropriate to use params into the configuration of the flow. Usually this must be configurated in the step <code>config.json</code> file. The recommendation is to use <code>params</code> just to overwrite a step parameter.</em></li>
<li><code>input</code> to share in a steps a previously emitted parameter in another steps. Please see <a href="./08-parameters-between-steps">parameters between steps</a> for more information.</li>
<li><code>excludes</code> array of contexts which execution is excluded for this step: <a href="#excludes">Log output</a> </li>
<li><code>implementation-check</code> If this step is not implemented execution will fail unless this parameter was set to false (default is true).<a href="#imple">Log output</a></li>
<li><code>watchContext</code> (default is false): If true the presence of contexts is re-evaluated at this step. Searching for new contexts that appears. <a href="#watchContext">See example</a></li>
</ul>
</li>
</ul>
<p><a name="excludes"></a>The execution of a flow with <code>exclude</code> on it will prompt this message on output:</p>
<pre><code class="lang-shell">[18:13:32] Run of step &quot;build&quot; is excluded for context &quot;feature&quot;
</code></pre>
<p><a name="imple"></a>The execution of a flow with <code>implementation-check</code> on it will prompt this message on output:</p>
<pre><code class="lang-shell">[18:13:32] Run of step &quot;provide-env&quot; is allowed to be not implemented for context &quot;app&quot;
</code></pre>
<p><a name="watchContext"></a><code>watchContext example:</code></p>
<pre><code class="lang-json">
{
  &quot;name&quot;: &quot;consolidate&quot;,
  &quot;description&quot;: &quot;[Git flow]: Check for semver relate updates&quot;,
  &quot;steps&quot;: {
    &quot;start&quot; : {
      &quot;type&quot; : &quot;flow&quot;
    },
    &quot;finish&quot; : {
      &quot;watchContext&quot; : true,
      &quot;type&quot; : &quot;flow&quot;
    }
  }
}
</code></pre>
<p>In this example start flow change old context named <code>master</code> to new context named <code>consolidation</code>, finish flow needs to reload contexts in order to realize that this new context is present and execute finish using the new context.</p>
<p>All options example:</p>
<pre><code class="lang-json">{
  &quot;steps&quot;: {
    &quot;step1&quot;: {
        &quot;excludes&quot; : [ &quot;any&quot; ],
        &quot;params&quot;: {
            &quot;param1&quot;: &quot;value1&quot;,
            &quot;param2&quot;: 2
        }
    },
    &quot;step2&quot;: {
        &quot;watchContext&quot; : true,
        &quot;type&quot; : &quot;flow&quot;,
    },
    &quot;step3&quot;: {
        &quot;implementation-check&quot; : false    
    }
  }
}
</code></pre>
<h4 id="repeated-steps">Repeated steps</h4>
<p>In some cases, it may be necessary to repeat the same step twice or more, with different parameters. Then it is possible to identify the step with a sufix separated with &#39;:&#39; character, like <code>step1:id1</code>.</p>
<p>Example:</p>
<pre><code class="lang-json">{
  &quot;steps&quot;: {
    &quot;mystep:first&quot;: {
      &quot;params&quot;: {
        &quot;myparam&quot;: &quot;value1&quot;
      }
    },
    &quot;mystep:second&quot;: {
      &quot;params&quot;: {
        &quot;myparam&quot;: &quot;value2&quot;
      }
    }
  }
}
</code></pre>
<p>In the above example, <code>mystep</code> is executed twice with different <code>myparam</code> configuration. It is advisable that the suffix has a semantic value which describe the differences.</p>
<h2 id="-a-name-scaffold-a-scaffold-generator"><a name="scaffold"></a>Scaffold generator</h2>
<p>Pisco provides a scaffold generator. Launch it placed inside your recipe with:</p>
<pre><code class="lang-sh">$ cd your-recipe
$ pisco recipe:add-flow
</code></pre>

      </article>
    </section>
    <script type="text/javascript" src="../../js/highlight.pack.js"></script>
    <script>
      hljs.initHighlightingOnLoad();
      $(function(){
      	$('.toggle_section').on('click', function(ev) {
          $(ev.currentTarget).parent('li').toggleClass('open');
        });
      });

    </script>
  </body>
</html>
