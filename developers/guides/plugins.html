

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Plugins</title>
    <link rel="stylesheet" type="text/css" href="../../css/main.css">
    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha256-/SIrNqv8h6QGKDuNoLGA4iret+kyesCkHGzVUUV0shc=" crossorigin="anonymous"></script>
  </head>
  <body>
    <section class="docs">
      <aside>

        <div class="logoContainer">
          <a href="/">
            <img src="../../images/logo.svg" class="logo" />
            Piscosour
          </a>

        </div>
        <ul class="main_menu">
          
            
            <li>
              <h4>General</h4>
              
                
              
                
                  
                    <a href="../../developers/get_started.html">Getting started</a>
                  
                
              
                
              
                
              
            </li>

            <li>
              <h4>Guides</h4>
              <ul>
              
                
              
                
              
                
                  
                  <li>
                    
                    <a href="../../developers/guides/configuration.html">Piscosour.json config file</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/analytics.html">Google Analytics Integration</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/api.html">API</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/0.2.0_migration_guide.html">Migrate from 0.1.0 version to 0.2.0 version</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/convert_to_recipe.html">Transform a node-module to recipe</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/Load_Parameters.html">Load Parameters</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/packaging.html">Best practices</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/Parameters_between_shots.html">Communication between steps</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/plugins.html" class="selected">Plugins</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/shots.html">Steps</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/straws.html">Flows</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/what_is_piscosour.html">What is piscosour</a>
                    
                  </li>
                  
                
              
                
              
              </ul>
            </li>

            <li>
              <h4>Tutorials</h4>
              <ul>
              
                
              
                
              
                
              
                
                  
                  <li>
                    
                    <a href="../../developers/tutorials/convert_to_recipe.html">Convert to recipe</a>
                    
                  </li>
                  
                
              
              </ul>
            </li>

            
            <li>
              <h4>Plugins</h4>
              <ul>
                
                  
                    
                    <li>
                      
                      <a href="../../developers/documents/context.html">context</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/fsutils.html">fsutils</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/inquirer.html">inquirer</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/installer.html">installer</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/launcher.html">launcher</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/os.html">os</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/piscosour.html">piscosour</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/skipper.html">skipper</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/stream-write-hook.html">stream-write-hook</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/system-checker.html">system-checker</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/system-saver.html">system-saver</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/test.html">test</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/userConfig.html">userConfig</a>
                      
                    </li>
                    
                  
                
                  
                
                  
                
                  
                
              </ul>
            </li>
            
            
          
            
          
            
          
            
          
        </ul>

        
          
        
          
        
          
        
          
          <a href="../../users/get_started.html"
            class="switch_target">
            Docs for users
          </a>
          
        
      </aside>
      <article>
        <h1 id="-qu-es-un-plugin-de-pisco-">¿Qué es un plugin de pisco?</h1>
<p>Es un prototipo que sirve para compartir funcionalidad de manera transversal entre shots y straws. El prototipo plugin actúa de dos maneras claramente diferenciadas.</p>
<ol>
<li>Como hook (o interceptor previo) en cada una de las fases del shot donde esté configurado.</li>
<li>Como repositorio de addons (métodos añadidos al prototipo shot) que añaden funcionalidad al objeto shot de manera transparente.</li>
</ol>
<p>este es el especto de un plugin tipo:</p>
<pre><code class="lang-js">&#39;use strict&#39;;

module.exports = {
    description : &quot;Test plugin&quot;,

    // ---- HOOKS ----

    check : function(shot){
        this.logger.info(&quot;---------PLUGIN TEST--------&quot;);
        shot.test_pluginAddon(&quot;Ejemplo&quot;);
    },

    // ---- ADDONS ----

    addons : {

        testPluginAddon: function (message) {
            this.logger.info(&quot;Test addon executed&quot;, name);
        }
    }
};
</code></pre>
<h2 id="hooks">HOOKS</h2>
<ul>
<li>En los hooks <strong>this</strong> será la referencia a la instancia shot que se está ejecutando en ese momento, por lo tanto con todas las propiedades y funciones del shot.</li>
<li>Las functions de los hooks deberán tener el mismo nombre que la fase (stage) que van a preceder.</li>
<li>Deberán devolver una Promesa o undefined. No está permitido hacer return de otro tipo de valor.</li>
</ul>
<h2 id="addons">ADDONS</h2>
<ul>
<li>Los addons son métodos que se añaden al prototipo Shot por lo tanto van a poderse ejecutar desde cualquier referencia a este prototipo.</li>
<li>Dentro de una función addon <strong>this</strong> hace referencia al shot donde se está ejecutando, será una referencia a la instancia ejecutandose en ese momento con todo completamente cargado.</li>
<li><p><strong>ATENCIÓN: Los plugins añaden funciones al prototype Shot</strong>. Para no sobreescribir funciones sensibles de Shot utilizar uno de estos dos métodos:</p>
<ol>
<li>(Recomendado): Prefijar las funciones añadidas con el nombre del plugin. En nuestro ejemplo será <strong>test</strong>.</li>
<li>Crear un espacio de nombres: Esta solución pierde la referencia al <strong>this</strong> del propio shot y habría que pasar el shot al llamar a la función. En nuestro ejemplo:</li>
</ol>
<p><strong>plugin.js:</strong></p>
</li>
</ul>
<pre><code class="lang-js">&#39;use strict&#39;;

module.exports = {
    description : &quot;Test plugin&quot;,

    // ---- HOOKS ----

    check : function(){
        this.logger.info(&quot;---------PLUGIN TEST--------&quot;);
        this.test.pluginAddon(this,&quot;Ejemplo&quot;);
    },

    // ---- ADDONS ----

    addons : {
        test : {
            pluginAddon: function (shot,message) {
                shot.logger.info(&quot;Test addon executed&quot;, message);
            }
        }
    }
};
</code></pre>
<h1 id="-c-mo-crear-un-plugin-">¿Cómo crear un plugin?</h1>
<p>Los plugins se pueden crear en cualquier receta y podrán ser usados desde cualquier receta que importe esta receta. Crear un plugin es tan simple como:</p>
<ol>
<li>Crear una carpeta plugins en la raíz de tu receta.</li>
<li>Crear una carpeta con el nombre que le queremos dar al plugin.</li>
<li>Crear un fichero llamado <strong>plugin.js</strong> dentro de esta carpeta con el contenido inidicado más arriba. Es conveniente añadir un fichero info.md con la documentación específica del plugin.</li>
<li>Listo! ya tienes tu plugin creado!</li>
</ol>
<p>Es aconsejable crear plugins en recetas separadas, es decir, crear una receta unicamente con un plugin o varios relacionados dentro con el fin de hacer una mejor gestión de las dependencias que estos plugins necesiten.</p>
<h1 id="-c-mo-usar-un-plugin-">¿Cómo usar un plugin?</h1>
<p>Usar un plugin es muy sencillo, sigue estos pasos:</p>
<ol>
<li><p>Si el plugin no está en tu receta importa el paquete npm de la receta donde se encuentre el plugin.</p>
<p> npm install mis-plugins --save</p>
</li>
<li><p>Define el nombre del plugin en cualquiera de los &quot;scopes&quot; pisco piscosour.json, straw.json, params.json <a href="Load_Parameters.md">Ver definición de parámetros</a>.</p>
</li>
</ol>
<p>en el caso de piscosour.json y straw.json</p>
<pre><code class="lang-js">[....]
  &quot;params&quot; : {
    &quot;plugins&quot; : [&quot;test&quot;]
  },
[....]
</code></pre>
<p>en el caso de params.json</p>
<pre><code class="lang-js">{
    &quot;plugins&quot; : [&quot;test&quot;]
}
</code></pre>
<ol>
<li><p>Listo!. El plugin ejecutará todos los hooks que tenga asociados y el shot tendrá disponible todos los addons que se hayan definido.</p>
<p>En nuestro ejemplo este sería el código del shot que usa el plugin test:</p>
</li>
</ol>
<pre><code class="lang-js"> &#39;use strict&#39;;

 module.exports = {
     description : &quot;Plugins test shot&quot;,

     config : function(resolve){
         this.logger.info(&quot;#magenta&quot;,&quot;config&quot;,&quot;Preparing params for main execution&quot;);
     },

     run : function(resolve){
         this.logger.info(&quot;#magenta&quot;,&quot;run&quot;,&quot;Run main execution&quot;);
         shot.test_pluginAddon(&quot;our example!!&quot;);
     },

     prove : function(resolve){
         this.logger.info(&quot;#magenta&quot;,&quot;prove&quot;,&quot;Prove that the run execution was ok&quot;);
     },

     notify : function(resolve){
         this.logger.info(&quot;#magenta&quot;,&quot;notify&quot;,&quot;Recollect all execution information and notify&quot;);
     }
 };
</code></pre>
<p>Al ejecutar el shot aparecerá nuesto mensaje:</p>
<p><img src="images/plugins1.png" alt="First plugin execution"></p>

      </article>
    </section>
    <script type="text/javascript" src="../../js/highlight.pack.js"></script>
    <script>
      hljs.initHighlightingOnLoad();
      $(function(){
      	$('.toggle_section').on('click', function(ev) {
          $(ev.currentTarget).parent('li').toggleClass('open');
        });
      });

    </script>
  </body>
</html>
