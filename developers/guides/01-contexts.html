

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Contexts</title>
    <link rel="stylesheet" type="text/css" href="../../css/main.css">
    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha256-/SIrNqv8h6QGKDuNoLGA4iret+kyesCkHGzVUUV0shc=" crossorigin="anonymous"></script>
  </head>
  <body>
    <section class="docs">
      <aside>

        <div class="logoContainer">
          <a href="../../index.html">
            <img src="../../images/logo.svg" class="logo" />
            Piscosour
          </a>

        </div>
        <ul class="main_menu">
          
            
            <li>
              <h4>General</h4>
              
                
                  
                    <a href="../../developers/what_is_piscosour.html">What is piscosour</a>
                  
                
              
                
                  
                    <a href="../../developers/get_started.html">Get started</a>
                  
                
              
                
                  
                    <a href="../../developers/.gitignore"></a>
                  
                
              
                
              
                
              
                
              
            </li>

            <li>
              <h4>Tutorials</h4>
              <ul>
              
                
              
                
              
                
              
                
              
                
              
                
                  
                  <li>
                    
                    <a href="../../developers/tutorials/pisco-website.html">Create WebSite Recipe</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/tutorials/img-empty-submenu.png"></a>
                    
                  </li>
                  
                
              
              </ul>
            </li>

            <li>
              <h4>Guides</h4>
              <ul>
              
                
              
                
              
                
              
                
              
                
                  
                  <li>
                    
                    <a href="../../developers/guides/01-contexts.html" class="selected">Contexts</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/02-steps.html">Steps</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/03-flows.html">Flows</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/04-stages.html">Stages</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/05-parameters.html">Parameters</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/06-inquire.html">Inquire</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/07-plugins.html">Plugins</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/08-parameters_between_steps.html">Communication between steps</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/09-steps-advanced.html">Advanced features in steps</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/10-requirements.html">Requirements</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/11-configuration.html">Recipe Configuration</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/12-guidelines.html">Guidelines</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/13-analytics.html">Google Analytics Integration</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/14-logger.html">Logger</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/15-implementations.html">Implementations</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/16-testing.html">Testing</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../developers/guides/17-glossary.html">Glossary</a>
                    
                  </li>
                  
                
              
                
              
              </ul>
            </li>

            
            <li>
              <h4>Plugins</h4>
              <ul>
                
                  
                
                  
                
                  
                
                  
                    
                    <li>
                      
                      <a href="../../developers/documents/context.html">context</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/fsutils.html">fsutils</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/inquirer.html">inquirer</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/installer.html">installer</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/launcher.html">launcher</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/os.html">os</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/piscosour.html">piscosour</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/skipper.html">skipper</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/stream-write-hook.html">stream-write-hook</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/system-checker.html">system-checker</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/system-saver.html">system-saver</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/test.html">test</a>
                      
                    </li>
                    
                    <li>
                      
                      <a href="../../developers/documents/userConfig.html">userConfig</a>
                      
                    </li>
                    
                  
                
                  
                
                  
                
              </ul>
            </li>
            
            
          
            
          
            
          
            
          
        </ul>

        
          
        
          
        
          
        
          
          <a href="../../users/get_started.html"
            class="switch_target">
            Docs for users
          </a>
          
        
      </aside>
      <article>
        <h1 id="contexts">Contexts</h1>
<p>The <code>contexts</code> define <strong><em>where</em></strong> and <strong><em>when</em></strong> pisco can be executed.</p>
<p>Contexts are implemented with three files in the recipe:</p>
<pre><code>-rwxr-xr-x    1 pisco  staff   contexts/context-name/config.json
-rwxr-xr-x    1 pisco  staff   contexts/context-name/index.js
-rwxr-xr-x    1 pisco  staff   contexts/context-name/info.md
</code></pre><p>Where the <code>config.json</code> file has the configuration, <code>info.md</code> explains and documents the context, and <code>index.js</code> has the implementation of the context.</p>
<p>Note, it exists a <a href="#scaffold">scaffold generator tool</a></p>
<h2 id="-config-json-configuration"><code>config.json</code> configuration</h2>
<p>The <code>config.json</code> file has the definition of the context:</p>
<pre><code class="lang-json">{
  &quot;name&quot;: &quot;context-name&quot;,
  &quot;description&quot;: &quot;A description of context-name&quot;
}
</code></pre>
<p>The contexts are described by two fields:</p>
<h3 id="-name-property"><code>name</code> property</h3>
<p>A short name for the context, it should be descriptive and unique.</p>
<ul>
<li>It is mandatory</li>
<li>String type expected</li>
</ul>
<h3 id="-description-property"><code>description</code> property</h3>
<p>It is a short description about the context.</p>
<ul>
<li>It is mandatory</li>
<li>String type expected</li>
</ul>
<h2 id="-index-js-implementation"><code>index.js</code> implementation</h2>
<p>The <code>index.js</code> file implements a <code>check()</code> function which defines the context. Please, replace it with the following content:</p>
<pre><code class="lang-javascript">&#39;use strict&#39;;
const path = require(&#39;path&#39;);
const process = require(&#39;process&#39;);

const _isWorldFolder = function() {
  let dir = process.cwd().split(path.sep);

  return dir[dir.length - 1] === &#39;world&#39;;
};

module.exports = {
  check() {
    return _isWorldFolder();
  }
};
</code></pre>
<h2 id="testing">Testing</h2>
<p>If we want to test this functionality, we simply create the following file:</p>
<pre><code class="lang-javascript">&quot;use strict&quot;;

/* global define, it, describe, before */
const assert = require(&#39;assert&#39;);
const contextWorld = require(&quot;../contexts/world/index.js&quot;);

describe(&quot;Verify the current folder with the step&quot;, () =&gt; {
    const currentDirectory = process.cwd();
    it(&quot;Should return KO because folder is not world, is test&quot;, () =&gt; {
        //Arrange
        //Act
        const isWorld = contextWorld.check();
        //Assert
        assert.ok(!isWorld, &quot;Folder is not world&quot;);
    });
    it(&quot;Should return OK because folder is world&quot;, () =&gt; {
        //Arrange
        process.chdir(&quot;test/world&quot;);
        //Act
        const isWorld = contextWorld.check();
        //Assert
        assert.ok(isWorld, &quot;Folder is not world&quot;);
    });
    afterEach(&quot;Get back to the correct directory&quot;, () =&gt; {
        process.chdir(currentDirectory);
    });
});
</code></pre>
<p>In this case we are testing the code  we recently made. But what of we want to test the functionality? We have made a functional test for that:</p>
<h2 id="functional-testing">Functional testing</h2>
<p>For the functional test we are going to think like pisco will do. How can pisco know wath context is involved in his operations? Pisco has an option (pisco -c) that tells you what are the contexts in the stacke. So let&#39;s do it ourselves:</p>
<pre><code class="lang-javascript">&quot;use strict&quot;;

/* global define, it, describe, before */
const expect = require(&#39;chai&#39;).expect;
const exec = require(&#39;child_process&#39;).exec;

describe(&#39;Pisco context world validation&#39;, function () {
    it(&#39;Should return the context world&#39;, (done) =&gt; {
        exec(&#39;pisco -c&#39;, {
            cwd: &#39;test/world&#39;
        }, (error, stdout, stderr) =&gt; {
            expect(error).to.equal(null);
            expect(stderr).to.equal(&#39;&#39;);
            expect(stdout).contain(&#39;world&#39;);
            done();
        });
    });
    it(&#39;Should return the context world&#39;, (done) =&gt; {
        exec(&#39;pisco -c&#39;, {
            cwd: &#39;test/notworld&#39;
        }, (error, stdout, stderr) =&gt; {
            expect(error).to.equal(null);
            expect(stderr).to.equal(&#39;&#39;);
            expect(stdout).not.contain(&#39;world&#39;);
            done();
        });
    });
});
</code></pre>
<p>In this scenario we are testing the two possible cases for this context validation: you are in the world context or you are not.</p>
<h2 id="documentation">Documentation</h2>
<p>The <code>info.md</code> file just explain the context with a markdown format:</p>
<pre><code class="lang-markdown"># Context context-name

The description about the context.
</code></pre>
<h2 id="-a-name-scaffold-a-scaffold-generator"><a name="scaffold"></a>Scaffold generator</h2>
<p>Pisco provides a scaffold generator. You can launch it by executing these commands:</p>
<pre><code class="lang-sh">$ cd your-recipe
$ pisco recipe:add-context
</code></pre>

      </article>
    </section>
    <script type="text/javascript" src="../../js/highlight.pack.js"></script>
    <script>
      hljs.initHighlightingOnLoad();
      $(function(){
      	$('.toggle_section').on('click', function(ev) {
          $(ev.currentTarget).parent('li').toggleClass('open');
        });
      });

    </script>
  </body>
</html>
