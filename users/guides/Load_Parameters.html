

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Load Parameters</title>
    <link rel="stylesheet" type="text/css" href="../../css/main.css">
    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha256-/SIrNqv8h6QGKDuNoLGA4iret+kyesCkHGzVUUV0shc=" crossorigin="anonymous"></script>
  </head>
  <body>
    <section class="docs">
      <aside>

        <div class="logoContainer">
          <a href="/">
            <img src="../../images/logo.svg" class="logo" />
            Piscosour
          </a>

        </div>
        <ul class="main_menu">
          
            
          
            
          
            
          
            
            <li>
              <h4>General</h4>
              
                
              
                
                  
                    <a href="../../users/get_started.html">Get started</a>
                  
                
              
                
              
                
              
            </li>

            <li>
              <h4>Guides</h4>
              <ul>
              
                
              
                
              
                
                  
                  <li>
                    
                    <a href="../../users/guides/Load_Parameters.html" class="selected">Load Parameters</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../users/guides/what_is_piscosour.html">What is Piscosour</a>
                    
                  </li>
                  
                
              
                
              
              </ul>
            </li>

            <li>
              <h4>Tutorials</h4>
              <ul>
              
                
              
                
              
                
              
                
                  
                  <li>
                    
                    <a href="../../users/tutorials/Parameters_between_shots.html">Parameters transmision between shots</a>
                    
                  </li>
                  
                  <li>
                    
                    <a href="../../users/tutorials/packaging.html">Packaging best practices</a>
                    
                  </li>
                  
                
              
              </ul>
            </li>

            
            <li>
              <h4>API</h4>
              <h5>FLOWS</h5>
              <ul>
                
                  
                    
                      
                        
                        <li>
                          
                          <a href="../../users/documents/flows/add-flow.html">add-flow</a>
                          
                        </li>
                        
                        <li>
                          
                          <a href="../../users/documents/flows/add-step.html">add-step</a>
                          
                        </li>
                        
                        <li>
                          
                          <a href="../../users/documents/flows/config.html">config</a>
                          
                        </li>
                        
                        <li>
                          
                          <a href="../../users/documents/flows/create.html">create</a>
                          
                        </li>
                        
                        <li>
                          
                          <a href="../../users/documents/flows/docs.html">docs</a>
                          
                        </li>
                        
                      
                    
                      
                    
                  
                
                  
                
                  
                
                  
                
              </ul>
              <h5>STEPS</h5>
              <ul>
                
                  
                    
                      
                    
                      
                        
                        <li>
                          
                          <a href="../../users/documents/steps/all_npm.html">all::npm</a>
                          
                        </li>
                        
                        <li>
                          
                          <a href="../../users/documents/steps/all_test.html">all::test</a>
                          
                        </li>
                        
                        <li>
                          
                          <a href="../../users/documents/steps/all_test2.html">all::test2</a>
                          
                        </li>
                        
                        <li>
                          
                          <a href="../../users/documents/steps/all_weather.html">all::weather</a>
                          
                        </li>
                        
                        <li>
                          
                          <a href="../../users/documents/steps/all_yeah.html">all::yeah</a>
                          
                        </li>
                        
                        <li>
                          
                          <a href="../../users/documents/steps/node-module_convert.html">node-module::convert</a>
                          
                        </li>
                        
                        <li>
                          
                          <a href="../../users/documents/steps/recipe_add-flows.html">recipe::add-flows</a>
                          
                        </li>
                        
                        <li>
                          
                          <a href="../../users/documents/steps/recipe_add-steps.html">recipe::add-steps</a>
                          
                        </li>
                        
                        <li>
                          
                          <a href="../../users/documents/steps/recipe_configure.html">recipe::configure</a>
                          
                        </li>
                        
                        <li>
                          
                          <a href="../../users/documents/steps/recipe_generate-docs.html">recipe::generate-docs</a>
                          
                        </li>
                        
                        <li>
                          
                          <a href="../../users/documents/steps/recipe_scaffolding.html">recipe::scaffolding</a>
                          
                        </li>
                        
                        <li>
                          
                          <a href="../../users/documents/steps/recipe_update.html">recipe::update</a>
                          
                        </li>
                        
                      
                    
                  
                
                  
                
                  
                
                  
                
              </ul>
            </li>
            
            
          
        </ul>

        
          
          <a href="../../developers/get_started.html"
            class="switch_target">
            Docs for developers
          </a>
          
        
          
        
          
        
          
        
      </aside>
      <article>
        <h1 id="lectura-de-par-metros-desde-un-shot">Lectura de parámetros desde un shot</h1>
<p>Todos los parametros que recibimos en un shot están centralizados en <strong>this.params</strong>. A contiuación se enumeran los métodos disponibles para la introducción de parámetros en la ejecución de pisco o de sus recetas.</p>
<h2 id="-1-opci-n-en-la-l-nea-de-comando-">(1) Opción en la línea de comando.</h2>
<pre><code>pisco --workingDir workspace --params1 value1 --params2 value2
</code></pre><p>el parámetro this.params.workingDir=&quot;workspace&quot;</p>
<p>También es posible pasar como parámetro de línea de comando un fichero json con definiciones de parámetros más complejas: Objetos y Arrays.</p>
<pre><code>pisco --paramsFile params.json
</code></pre><p>Donde params.json será algo así:</p>
<pre><code>{
  &quot;workingDir&quot;: &quot;workspace&quot;,
  &quot;params1&quot;: &quot;value1&quot;,
  &quot;params2&quot;: &quot;value2&quot;
  &quot;objParam&quot;: {
    &quot;params3&quot;: &quot;value3&quot;
  },
  &quot;arrayParam&quot;: [1,2,3]
 }
</code></pre><h2 id="-2-configuraci-n-en-el-fichero-piscosour-json">(2) Configuración en el fichero piscosour.json</h2>
<p>Este fichero puede estar:</p>
<ul>
<li>En el directorio .piscosour al mismo nivel desde donde se ejecuta el comando pisco.</li>
<li>En la raiz de la receta</li>
</ul>
<p>La definición de los parámetros incluye estos ámbitos (scopes):</p>
<p><strong>Común para todos los straws que se ejecuten y por consiguiente para todos los shots contenidos:</strong></p>
<pre><code class="lang-js">{
    &quot;params&quot;: {
        &quot;workingDir&quot;: &quot;workspace&quot;
    },

    [...]
}
</code></pre>
<p><strong>Común para todos los shots de un straw:</strong> (&quot;validate&quot; es el nombre del straw)</p>
<pre><code class="lang-js">{
    [...]
    &quot;straws&quot; : {
        &quot;validate&quot; : {
            &quot;params&quot; : {
                &quot;workingDir&quot;: &quot;workspace&quot;
            }
        }
    }
    [...]
}
</code></pre>
<p><strong>Común para todos los repoTypes de un shot:</strong> (&quot;install&quot; es el nombre del shot)</p>
<pre><code class="lang-js">{
    [...]
    &quot;shots&quot; : {
        &quot;install&quot; : {
            &quot;params&quot; : {
                &quot;workingDir&quot;: &quot;workspace&quot;
            }
        }
    }
    [...]
}
</code></pre>
<p><strong>Específico para un shot y para un repoType dado:</strong> (&quot;component&quot; es el repoType)</p>
<pre><code class="lang-js">{
    [...]
    &quot;shots&quot; : {
        &quot;install&quot; : {
            &quot;component&quot; : {
                &quot;params&quot; : {
                    &quot;workingDir&quot;: &quot;workspace&quot;
                }
            }
        }
    }
    [...]
}
</code></pre>
<p>Todas estas opciones acabarán con el parámetro this.params.workingDir=&quot;workspace&quot;.</p>
<h3 id="prioridad-">Prioridad:</h3>
<ul>
<li><strong>1</strong> fichero .piscosour/piscosour.json al mismo nivel de la ejecución del comando.<ul>
<li><strong>1.1</strong> Específico para un shot y para un repoType dado.</li>
<li><strong>1.2</strong> Común para todos los repoTypes de un shot.</li>
<li><strong>1.3</strong> Común para todos los shots de un straw.</li>
<li><strong>1.4</strong> Común para todos los straws.</li>
</ul>
</li>
<li><strong>2</strong> piscosour.json de la receta.<ul>
<li>(el mismo que el anterior)</li>
</ul>
</li>
</ul>
<p>NOTA: En caso de estar definido varias veces un parámetro será sobre-escrito por el número más pequeño de esta lista.</p>
<h2 id="-3-configuraci-n-en-el-fichero-straw-json">(3) Configuración en el fichero straw.json</h2>
<p>Este fichero se encuentra en la receta en [recipeRoot]/straws/[recipeName]/straw.json</p>
<p><strong>Común para todos los shots del straw</strong></p>
<pre><code class="lang-js">{
    &quot;params&quot;: {
        &quot;workingDir&quot;: &quot;workspace&quot;
    },
    &quot;shots&quot; : {
        [...]
    }
}
</code></pre>
<p><strong>Común para todos los repoTypes de un shot</strong> (&quot;install&quot; es el nombre del shot)</p>
<pre><code class="lang-js">{
    &quot;params&quot;: {},
    &quot;shots&quot; : {
        &quot;install&quot; : {
            &quot;params&quot; : {
                &quot;workingDir&quot;: &quot;workspace&quot;
            }
        }
    }
}
</code></pre>
<p><strong>Específico para un shot y para un repoType dado</strong> (&quot;component&quot; es el repoType)</p>
<pre><code class="lang-js">{
    &quot;params&quot;: {},
    &quot;shots&quot; : {
        &quot;install&quot; : {
            &quot;component&quot; : {
                &quot;params&quot; : {
                    &quot;workingDir&quot;: &quot;workspace&quot;
                }
            }
        }
    }
}
</code></pre>
<p>Todas estas opciones acabarán con el parámetro this.params.workingDir=&quot;workspace&quot;.</p>
<h3 id="prioridad-">Prioridad:</h3>
<ul>
<li><strong>1</strong> Específico para un shot y para un repoType dado.</li>
<li><strong>2</strong> Común para todos los repoTypes de un shot.</li>
<li><strong>3</strong> Común para todos los shots de un straw.</li>
</ul>
<p>NOTA: En caso de estar definido varias veces un parámetro será sobre-escrito por el número más pequeño de esta lista.</p>
<h2 id="-4-configuraci-n-en-el-fichero-params-json-de-un-shot">(4) Configuración en el fichero params.json de un shot</h2>
<p>Existen dos localizaciones para este fichero:</p>
<p><strong>Común para todos los repoTypes del shot</strong> (&quot;install&quot; es el nombre del shot)</p>
<p>Este fichero se encuentra en la receta en [recipeRoot]/shots/[shotName]/params.json</p>
<pre><code class="lang-js">{
    &quot;workingDir&quot; : &quot;workspace&quot;
}
</code></pre>
<p><strong>Específico para un repoType dado</strong> (&quot;component&quot; es el repoType)</p>
<p>Este fichero se encuentra en la receta en [recipeRoot]/shots/[shotName]/[repoType]/params.json</p>
<pre><code class="lang-js">{
    &quot;workingDir&quot; : &quot;workspace&quot;
}
</code></pre>
<p>El parámetro será this.params.workingDir=&quot;workspace&quot;.</p>
<h3 id="prioridad-">Prioridad:</h3>
<ul>
<li><strong>1</strong> Específico para un repoType dado.</li>
<li><strong>2</strong> Común para todos los repoTypes del shot.</li>
</ul>
<p>NOTA: En caso de estar definido varias veces un parámetro será sobre-escrito por el número más pequeño de esta lista.</p>
<h2 id="-5-pregunta-al-usuario-interactivamente-">(5) Pregunta al usuario interactivamente.</h2>
<p>Para ello será necesario configurar el parámetro prompts en el fichero <strong>params.json</strong>. La definición de parámetros en el array de prompts usa el formato del módulo inquirer</p>
<p><a href="https://www.npmjs.com/package/inquirer">Documentación de inquirer</a></p>
<p>Se han añadido dos parámetros más a la configuración de inquirer:</p>
<ul>
<li><strong>env</strong>: Nombre de la variable de entorno que se intentará usar para resolver este parámetro antes de preguntar al usuario de manera interactiva.</li>
<li><strong>required</strong>: (true/false) Establece si el campo es obligatorio o no.</li>
</ul>
<pre><code class="lang-js">  &quot;prompts&quot;: [
    {
      &quot;type&quot;: &quot;input&quot;,
      &quot;name&quot;: &quot;workingDir&quot;,
      &quot;required&quot; : true,
      &quot;message&quot;: &quot;Where do you want to work?&quot;,
      &quot;env&quot; : &quot;bamboo_WORKING_DIR&quot;,
      &quot;value&quot; : &quot;valor fijo&quot;
    }
  ]
</code></pre>
<h3 id="asignar-funciones-a-los-par-metros-check-validate-y-choices-">Asignar funciones a los parámetros check, validate y choices.</h3>
<p>Dado que params.json es un fichero json y no está permitido escribir código javascript se ha habilitado una forma de asignar funciones propias del shot a los parámetros check, validate y choices de inquirer.</p>
<pre><code class="lang-js">  &quot;prompts&quot;: [
    {
      &quot;type&quot;: &quot;input&quot;,
      &quot;name&quot;: &quot;workingDir&quot;,
      &quot;required&quot; : true,
      &quot;message&quot;: &quot;Where do you want to work?&quot;,
      &quot;when&quot; : &quot;#workingDirFunction&quot;
    }
  ]
</code></pre>
<p>mediante &quot;#...nombre de la función&quot; le decimos a piscosour que función tiene que ejecutar inquirer al cargar la variable.</p>
<p>Ahora en el shot simplemente definimos:</p>
<pre><code class="lang-js">module.exports = {
    description : &quot;Adding shot to a straw&quot;,

    [...]

    workingDirFunction : function(answer){
        return answer.workingDir;
    },

    [...]
}
</code></pre>
<p><strong>answer</strong> es el objeto completo con las respuestas del usuario.  </p>
<p>El parámetro será this.params.workingDir=&quot;workspace&quot;.</p>
<p>Creando la lista prompts en <strong>params.json</strong> automáticamente el shot preguntará al usuario siempre que el parámetro no venga informado.</p>
<h3 id="prioridad-">Prioridad:</h3>
<p> Si se usa más de un método para introducir un parámetro este será el orden de prioridad usado para estar disponible en <strong>this.params</strong></p>
<ul>
<li>1 - Parámetro por línea de comando.</li>
<li>2 - Variable de entorno especificada en el parámetro env del prompt.</li>
<li>3 - Configuración del fichero .piscosour/piscosour.json.</li>
<li>4 - Configuración del fichero piscosour.json de la receta.</li>
<li>5 - Configuración del fichero straw.json de la receta. ([recipeRoot]/straws/[recipeName]/straw.json)</li>
<li>6 - Configuración del fichero params.json de la receta. ([recipeRoot]/shots/[shotName]/[repoType]/params.json)</li>
<li>7 - valor del parámetro &quot;value&quot; dentro de un prompt.</li>
<li>8 - Pregunta al usuario si todas las enteriores no vienen informadas.</li>
</ul>
<p>NOTA: En caso de estar definido varias veces un parámetro será sobre-escrito por el número más pequeño de esta lista.</p>

      </article>
    </section>
    <script type="text/javascript" src="../../js/highlight.pack.js"></script>
    <script>
      hljs.initHighlightingOnLoad();
      $(function(){
      	$('.toggle_section').on('click', function(ev) {
          $(ev.currentTarget).parent('li').toggleClass('open');
        });
      });

    </script>
  </body>
</html>
